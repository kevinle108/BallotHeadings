<!-- TABLE -->

<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel='stylesheet' href='ballot.css' />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
    <script type="text/javascript" src="qrcode.min.js"></script>
    <script src='ballot.js'></script>
    <!-- <script src='ballot_260111_d.js'></script> -->
    <script src='WATERVILLE.js'></script>
    <!-- <script src='data.js'></script> -->
    <script src='ballotpdf.js'></script>
    <script src='buildSelectionPage.js'></script>
    <script src='ovalSelection.js'></script>
    <script src='buildReviewPage.js'></script>
    <script src='keyboard.js'></script>
    <title>Bradley Democratic Primary</title>
</head>

<body>
    <div id="selection">
        <section style="background-color: #e6e9ed; padding: 10px;">
            <h1>State of Maine Office Ballot</h1>
            <h1>Democratic Primary Election, July 14, 2020</h1>
            <h3>for</h3>
            <h3>Bradley</h3>
        </section>

        <main id="contests">
        </main>
        <button id="doneButton" type="submit">Done</button>
        <hr style="height: 5px; background-color: black;" />
        <div class='btn-wrapper'>
            <button class='btn-inline' onclick="doneAndCreatePdf()">Create PDF</button>
            <button class='btn-inline' onclick="doneAndCreateQRCode()">Create QR
                Code</button>
        </div>
    </div>

    <div id='qrpage' style="display: none;">
        <div class='btn-wrapper'>
            <button class='btn-inline' onclick="backToSelection()">&larr;&ensp;Back</button>
        </div>
        <h3>Please bring this QR code to the polling site to print your ballot</h3>
        <div id="qrcode" style="width:200px; height:200px; margin:40px auto;"></div>
    </div>

    <div id="review">
        <h1>Review</h1>
        <div id="reviewBody"></div>
        <div id="reviewFooter">
            <button class="backButton" type="submit">Back</button>
            <button onclick="createBallotPdf(ballot)">Create PDF</button>
        </div>
    </div>


    <script type="text/javascript">
        var qrcode = new QRCode(document.getElementById("qrcode"), {
            width: 200,
            height: 200
        });

        function doneAndCreateQRCode() {
            qrcode.makeCode(encodeVotes())
            document.getElementById('selection').style.display = 'none';
            document.getElementById('qrpage').style.display = 'block';
        }

        function encodeVotes() {
            let votes = ''
            let writeIns = ''
            syncSelectedVotesToBallotData()
            ballot.contests.forEach((contest, contestIndex) => {
                contest.candidates.forEach((candidate, candidateIndex) => {
                    votes += candidate.selected.toString()
                    if (candidate.selected && candidate.candidateCode.includes('writein')) {
                        writeIns += '|' + candidate.candidateName
                    }
                })
            })
            return votes + writeIns;
        }

        function backToSelection() {
            document.getElementById('selection').style.display = 'block';
            document.getElementById('qrpage').style.display = 'none';
        }
    </script>

</body>