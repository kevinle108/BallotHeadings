<!-- TABLE -->

<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="user-scalable=1" />
    <!-- <meta name="viewport" content="width=device-width" /> -->
    <title>Bradley Democratic Primary</title>

    <link rel='stylesheet' href='ballot.css' />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
    <script type="text/javascript" src="qrcode.min.js"></script>
    <script src='ballot.js'></script>
    <!-- <script src='ballot_260111_d.js'></script> -->
    <script src='WATERVILLE.js'></script>
    <!-- <script src='data.js'></script> -->
    <script src='ballotpdf.js'></script>
    <script src='buildSelectionPage.js'></script>
    <script src='ovalSelection.js'></script>
    <script src='buildReviewPage.js'></script>
    <script src='keyboard.js'></script>
    <script src='affidavitPage.js'></script>

    <!-- pwa manifests -->
    <link rel="manifest" href="/manifest.json">
    <!-- ios support -->
    <link rel="apple-touch-icon" href="/img/icons/icon-96x96.png">
    <meta name="apple-mobile-web-app-status-bar" content="#FFE1C4">
    <meta name="theme-color" content="#f69435">
</head>

<body>
    <div id="selection">
        <section style="background-color: #e6e9ed; padding: 10px;">
            <h1>State of Maine Office Ballot</h1>
            <h1>Democratic Primary Election, July 14, 2020</h1>
            <h3>for</h3>
            <h3>Bradley</h3>
        </section>

        <main id="contests">
        </main>
        <button id="reviewButton">Review</button>
    </div>

    <!-- <div id='qrpage' style="display: none;">
        <div class='btn-wrapper'>
            <button class="btn-inline" onclick="backToSelection()">&larr;&ensp;Back</button>
        </div>
        <h3>Please bring this QR code to the polling site to print your ballot</h3>
        <div id="qrcode" style="width:200px; height:200px; margin:40px auto;"></div>
    </div> -->

    <div id="reviewPage">
        <h1>Review</h1>
        <p id="reviewPageInstructions">Listed below is a summary of your selections for each contest. If you need to change your selection, each contest is a link that will scroll you back to that part of the ballot where you change your selections. When you are done reviewing all selections, please continue to the next page where you can read and sign your Voter Affirmation Page.</p>
        <div id="reviewBody"></div>
        <div id="reviewFooter" class="buttonDiv">
            <button onclick="backToSelection()">Back to Selection Page</button>
            <button onclick="goToAffirmation()">Go to Affirmation Page</button>
            <!-- <button onclick="createBallotPdf(ballot)">Create PDF</button>  -->
        </div>
    </div>
    


    
    <div id="overlay"></div>
    <div id="modal" role="alertdialog" aria-labelledby="modalTitle" aria-describedby="modalText">
        <h2 id="modalTitle">Confirm Selection</h2>
        <p id="modalText">Modal text here</p>
        <div class="modalButtonDiv">
            <button class="button" onclick="return false;" id="yesButton">Yes</a>
            <button class="button" onclick="return false;" id="noButton">No</a>
        </div>
    </div>

    <script type="text/javascript">
        // var qrcode = new QRCode(document.getElementById("qrcode"), {
        //     width: 200,
        //     height: 200
        // });

        function doneAndCreateQRCode() {
            qrcode.makeCode(encodeVotes())
            document.getElementById('selection').style.display = 'none';
            document.getElementById('qrpage').style.display = 'block';
        }

        function encodeVotes() {
            let votes = ''
            let writeIns = ''
            syncSelectedVotesToBallotData()
            ballot.contests.forEach((contest, contestIndex) => {
                contest.candidates.forEach((candidate, candidateIndex) => {
                    votes += candidate.selected.toString()
                    if (candidate.selected && candidate.candidateCode.includes('writein')) {
                        writeIns += '|' + candidate.candidateName
                    }
                })
            })
            return votes + writeIns;
        }

        function backToSelection() {
            document.getElementById('selection').style.display = 'block';
            document.getElementById('reviewPage').style.display = 'none';
            document.getElementById('affidavitPage').style.display = 'none';

        }

        function backToReview() {
            document.getElementById('selection').style.display = 'none';
            document.getElementById('reviewPage').style.display = 'block';
            document.getElementById('affidavitPage').style.display = 'none';
        }



        function goToAffirmation() {
            document.getElementById('selection').style.display = 'none';
            document.getElementById('reviewPage').style.display = 'none';
            document.getElementById('affidavitPage').style.display = 'block';
            document.getElementById('affidavitPage').scrollIntoView();
        }
    </script>

</body>